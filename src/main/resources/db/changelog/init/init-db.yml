databaseChangeLog:
  # Organization table
  - changeSet:
      id: 2025-02-01-1
      author: belkanaphan
      onFail: MARK_RAN
      changes:
        - sql:
            sql: |
              CREATE TABLE IF NOT EXISTS organization (
                id BIGSERIAL PRIMARY KEY,
                name VARCHAR(255),
                description TEXT,
                phone_number VARCHAR(50),
                email VARCHAR(255),
                country VARCHAR(100),
                city VARCHAR(100),
                street_name VARCHAR(255),
                street_number VARCHAR(50),
                comment TEXT,
                created_at TIMESTAMP,
                created_by VARCHAR(255),
                modified_at TIMESTAMP,
                modified_by VARCHAR(255),
                version BIGINT NOT NULL DEFAULT 0
              );
      rollback:
        - sql:
            sql: |
              DROP TABLE IF EXISTS organization;

  # Users table
  - changeSet:
      id: 2025-02-01-3
      author: belkanaphan
      onFail: MARK_RAN
      changes:
        - sql:
            sql: |
              CREATE TABLE IF NOT EXISTS users (
                id BIGSERIAL PRIMARY KEY,
                username VARCHAR(100) NOT NULL UNIQUE,
                password VARCHAR(500) NOT NULL,
                status VARCHAR(20) NOT NULL,
                name VARCHAR(255),
                surname VARCHAR(255),
                second_name VARCHAR(255),
                email VARCHAR(255),
                phone_number VARCHAR(50),
                organization_id BIGINT,
                created_at TIMESTAMP,
                created_by VARCHAR(255),
                modified_at TIMESTAMP,
                modified_by VARCHAR(255),
                version BIGINT NOT NULL DEFAULT 0,
                FOREIGN KEY (organization_id) REFERENCES organization(id)
              );
      rollback:
        - sql:
            sql: |
              DROP TABLE IF EXISTS users;

  # User-Roles table (ElementCollection for enum roles)
  - changeSet:
      id: 2025-02-01-2
      author: belkanaphan
      onFail: WARN
      changes:
        - sql:
            sql: |
              CREATE TABLE IF NOT EXISTS user_roles (
                user_id BIGINT NOT NULL,
                role VARCHAR(50) NOT NULL,
                PRIMARY KEY (user_id, role),
                FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
              );
      rollback:
        - sql:
            sql: |
              DROP TABLE IF EXISTS user_roles;

  # Occasion table
  - changeSet:
      id: 2025-02-01-5
      author: belkanaphan
      onFail: MARK_RAN
      changes:
        - sql:
            sql: |
              CREATE TABLE IF NOT EXISTS occasion (
                id BIGSERIAL PRIMARY KEY,
                name VARCHAR(255),
                description TEXT,
                status VARCHAR(20) NOT NULL,
                start_date DATE,
                end_date DATE,
                organization_id BIGINT,
                created_at TIMESTAMP,
                created_by VARCHAR(255),
                modified_at TIMESTAMP,
                modified_by VARCHAR(255),
                version BIGINT NOT NULL DEFAULT 0,
                FOREIGN KEY (organization_id) REFERENCES organization(id)
              );
      rollback:
        - sql:
            sql: |
              DROP TABLE IF EXISTS occasion;

  # Activity table
  - changeSet:
      id: 2025-02-01-6
      author: belkanaphan
      onFail: MARK_RAN
      changes:
        - sql:
            sql: |
              CREATE TABLE IF NOT EXISTS activity (
                id BIGSERIAL PRIMARY KEY,
                name VARCHAR(255),
                description TEXT,
                status VARCHAR(20) NOT NULL,
                start_date_time TIMESTAMP,
                end_date_time TIMESTAMP,
                country VARCHAR(100),
                city VARCHAR(100),
                street_name VARCHAR(255),
                street_number VARCHAR(50),
                comment TEXT,
                occasion_id BIGINT,
                created_at TIMESTAMP,
                created_by VARCHAR(255),
                modified_at TIMESTAMP,
                modified_by VARCHAR(255),
                version BIGINT NOT NULL DEFAULT 0,
                FOREIGN KEY (occasion_id) REFERENCES occasion(id)
              );
      rollback:
        - sql:
            sql: |
              DROP TABLE IF EXISTS activity;

  # Activity Rule table
  - changeSet:
      id: 2025-02-01-7
      author: belkanaphan
      onFail: MARK_RAN
      changes:
        - sql:
            sql: |
              CREATE TABLE IF NOT EXISTS activity_rule (
                id BIGSERIAL PRIMARY KEY,
                created_at TIMESTAMP,
                created_by VARCHAR(255),
                modified_at TIMESTAMP,
                modified_by VARCHAR(255),
                version BIGINT NOT NULL DEFAULT 0
              );
      rollback:
        - sql:
            sql: |
              DROP TABLE IF EXISTS activity_rule;

  # Milestone table
  - changeSet:
      id: 2025-02-01-8
      author: belkanaphan
      onFail: MARK_RAN
      changes:
        - sql:
            sql: |
              CREATE TABLE IF NOT EXISTS milestone (
                id BIGSERIAL PRIMARY KEY,
                name VARCHAR(255),
                description TEXT,
                status VARCHAR(20) NOT NULL,
                activity_id BIGINT,
                created_at TIMESTAMP,
                created_by VARCHAR(255),
                modified_at TIMESTAMP,
                modified_by VARCHAR(255),
                version BIGINT NOT NULL DEFAULT 0,
                FOREIGN KEY (activity_id) REFERENCES activity(id)
              );
      rollback:
        - sql:
            sql: |
              DROP TABLE IF EXISTS milestone;

  # Milestone Rule table
  - changeSet:
      id: 2025-02-01-9
      author: belkanaphan
      onFail: MARK_RAN
      changes:
        - sql:
            sql: |
              CREATE TABLE IF NOT EXISTS milestone_rule (
                id BIGSERIAL PRIMARY KEY,
                created_at TIMESTAMP,
                created_by VARCHAR(255),
                modified_at TIMESTAMP,
                modified_by VARCHAR(255),
                version BIGINT NOT NULL DEFAULT 0
              );
      rollback:
        - sql:
            sql: |
              DROP TABLE IF EXISTS milestone_rule;

  # Round table
  - changeSet:
      id: 2025-02-01-10
      author: belkanaphan
      onFail: MARK_RAN
      changes:
        - sql:
            sql: |
              CREATE TABLE IF NOT EXISTS round (
                id BIGSERIAL PRIMARY KEY,
                name VARCHAR(255),
                description TEXT,
                status VARCHAR(20) NOT NULL,
                milestone_id BIGINT,
                created_at TIMESTAMP,
                created_by VARCHAR(255),
                modified_at TIMESTAMP,
                modified_by VARCHAR(255),
                version BIGINT NOT NULL DEFAULT 0,
                FOREIGN KEY (milestone_id) REFERENCES milestone(id)
              );
      rollback:
        - sql:
            sql: |
              DROP TABLE IF EXISTS round;

  # Participant table
  - changeSet:
      id: 2025-02-01-11
      author: belkanaphan
      onFail: MARK_RAN
      changes:
        - sql:
            sql: |
              CREATE TABLE IF NOT EXISTS participant (
                id BIGSERIAL PRIMARY KEY,
                name VARCHAR(255),
                surname VARCHAR(255),
                second_name VARCHAR(255),
                email VARCHAR(255),
                phone_number VARCHAR(50),
                number VARCHAR(100),
                competition_role VARCHAR(20),
                created_at TIMESTAMP,
                created_by VARCHAR(255),
                modified_at TIMESTAMP,
                modified_by VARCHAR(255),
                version BIGINT NOT NULL DEFAULT 0
              );
      rollback:
        - sql:
            sql: |
              DROP TABLE IF EXISTS participant;

#  # Create indexes for better performance
#  - changeSet:
#      id: 2025-02-01-12
#      author: belkanaphan
#      onFail: MARK_RAN
#      changes:
#        - sql:
#            sql: |
#              CREATE INDEX IF NOT EXISTS idx_users_username ON users(username);
#              CREATE INDEX IF NOT EXISTS idx_users_email ON users(email) WHERE email IS NOT NULL;
#              CREATE INDEX IF NOT EXISTS idx_users_organization_id ON users(organization_id);
#              CREATE INDEX IF NOT EXISTS idx_occasion_organization_id ON occasion(organization_id);
#              CREATE INDEX IF NOT EXISTS idx_activity_occasion_id ON activity(occasion_id);
#              CREATE INDEX IF NOT EXISTS idx_milestone_activity_id ON milestone(activity_id);
#              CREATE INDEX IF NOT EXISTS idx_participant_activity_id ON participant(activity_id);
#              CREATE INDEX IF NOT EXISTS idx_participant_round_id ON participant(round_id);
#              CREATE INDEX IF NOT EXISTS idx_organization_email ON organization(email) WHERE email IS NOT NULL;
#      rollback:
#        - sql:
#            sql: |
#              DROP INDEX IF EXISTS idx_users_username;
#              DROP INDEX IF EXISTS idx_users_email;
#              DROP INDEX IF EXISTS idx_users_organization_id;
#              DROP INDEX IF EXISTS idx_occasion_organization_id;
#              DROP INDEX IF EXISTS idx_activity_occasion_id;
#              DROP INDEX IF EXISTS idx_milestone_activity_id;
#              DROP INDEX IF EXISTS idx_participant_activity_id;
#              DROP INDEX IF EXISTS idx_participant_round_id;
#              DROP INDEX IF EXISTS idx_organization_email;
