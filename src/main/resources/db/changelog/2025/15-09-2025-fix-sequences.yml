databaseChangeLog:
  # Fix sequences to avoid ID conflicts
  - changeSet:
      id: 2025-09-15-11
      author: belkanaphan
      changes:
        - sql:
            sql: |
              -- Обновляем последовательности для всех таблиц, чтобы избежать конфликтов ID
              -- PostgreSQL автоматически создает последовательности для SERIAL/BIGSERIAL полей
              -- Используем GREATEST для гарантии, что значение не меньше 1
              
              -- Для organization (максимальный ID = 2)
              SELECT setval('organization_id_seq', GREATEST(COALESCE((SELECT MAX(id) FROM organization), 0), 1));
              
              -- Для users (максимальный ID = 3)
              SELECT setval('users_id_seq', GREATEST(COALESCE((SELECT MAX(id) FROM users), 0), 1));
              
              -- Для occasion (максимальный ID = 2)
              SELECT setval('occasion_id_seq', GREATEST(COALESCE((SELECT MAX(id) FROM occasion), 0), 1));
              
              -- Для activity (максимальный ID = 3)
              SELECT setval('activity_id_seq', GREATEST(COALESCE((SELECT MAX(id) FROM activity), 0), 1));
              
              -- Для milestone (максимальный ID = 4)
              SELECT setval('milestone_id_seq', GREATEST(COALESCE((SELECT MAX(id) FROM milestone), 0), 1));
              
              -- Для round (максимальный ID = 4)
              SELECT setval('round_id_seq', GREATEST(COALESCE((SELECT MAX(id) FROM round), 0), 1));
              
              -- Для participant (максимальный ID = 4)
              SELECT setval('participant_id_seq', GREATEST(COALESCE((SELECT MAX(id) FROM participant), 0), 1));
              
              -- Для criteria (максимальный ID = 7)
              SELECT setval('criteria_id_seq', GREATEST(COALESCE((SELECT MAX(id) FROM criteria), 0), 1));
              
              -- Для milestone_criteria_assignment (максимальный ID = 14)
              SELECT setval('milestone_criteria_assignment_id_seq', GREATEST(COALESCE((SELECT MAX(id) FROM milestone_criteria_assignment), 0), 1));
              
              -- Для user_activity_assignment (если есть данные)
              SELECT setval('user_activity_assignment_id_seq', GREATEST(COALESCE((SELECT MAX(id) FROM user_activity_assignment), 0), 1));
              
#              -- Для activity_rule (если есть данные)
#              SELECT setval('activity_rule_id_seq', GREATEST(COALESCE((SELECT MAX(id) FROM activity_rule), 0), 1));
#
#              -- Для milestone_rule (если есть данные)
#              SELECT setval('milestone_rule_id_seq', GREATEST(COALESCE((SELECT MAX(id) FROM milestone_rule), 0), 1));
