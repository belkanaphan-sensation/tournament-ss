databaseChangeLog:
  # Create judge_round_status table
  - changeSet:
      id: 2025-10-04-1
      author: belkanaphan
      onFail: MARK_RAN
      changes:
        - sql:
            sql: |
              CREATE TABLE IF NOT EXISTS judge_round_status (
                id BIGSERIAL PRIMARY KEY,
                judge_id BIGINT NOT NULL,
                round_id BIGINT NOT NULL,
                status VARCHAR(20) NOT NULL,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                created_by VARCHAR(255),
                modified_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                modified_by VARCHAR(255),
                version BIGINT NOT NULL DEFAULT 0,
                FOREIGN KEY (judge_id) REFERENCES user_activity_assignment(id) ON DELETE CASCADE,
                FOREIGN KEY (round_id) REFERENCES round(id) ON DELETE CASCADE,
                UNIQUE(judge_id, round_id)
              );
      rollback:
        - sql:
            sql: |
              DROP TABLE IF EXISTS judge_round_status;

  # Create index for better performance
  - changeSet:
      id: 2025-10-04-2
      author: belkanaphan
      onFail: MARK_RAN
      changes:
        - sql:
            sql: |
              CREATE INDEX IF NOT EXISTS idx_judge_round_status_round_id ON judge_round_status(round_id);
              CREATE INDEX IF NOT EXISTS idx_judge_round_status_judge_id ON judge_round_status(judge_id);
              CREATE INDEX IF NOT EXISTS idx_judge_round_status_status ON judge_round_status(status);
      rollback:
        - sql:
            sql: |
              DROP INDEX IF EXISTS idx_judge_round_status_round_id;
              DROP INDEX IF EXISTS idx_judge_round_status_judge_id;
              DROP INDEX IF EXISTS idx_judge_round_status_status;
